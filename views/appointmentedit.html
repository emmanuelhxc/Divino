{% extends 'layout.html' %}


        <!-- VENDORS -->
       <!--  <link href="/vendors/bower_components/animate.css/animate.min.css" rel="stylesheet">
        <link href="/vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.css" rel="stylesheet">
        <link href="/vendors/bower_components/material-design-iconic-font/dist/css/material-design-iconic-font.min.css" rel="stylesheet">
        
        
        
       
        <link href="/vendors/farbtastic/farbtastic.css" rel="stylesheet">
       
 -->
        
        <link href="vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.css" rel="stylesheet">
        <link href="/vendors/summernote/dist/summernote.css" rel="stylesheet">
        <link href="/vendors/bower_components/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css" rel="stylesheet">        
        <link href="/vendors/bower_components/nouislider/distribute/jquery.nouislider.min.css" rel="stylesheet">
        
        <!-- <link href="/css/app.min.1.css" rel="stylesheet">
        <link href="/css/app.min.2.css" rel="stylesheet"> -->

        <link href="/vendors/bower_components/bootstrap-select/dist/css/bootstrap-select.css" rel="stylesheet">
        <link href="/vendors/bower_components/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
{% block content %}
<div class="container">
    <div class="card">
        <div class="card-header bgm-deeporange">
            <h2>Modificar Cita<small></small></h2>
        </div>
        
        <div class="card-body card-padding">
            <div class="row">
                <form  method="POST" action="/appointment/{{cita.uuid}}" enctype="multipart/form-data">
                    <p class="c-black f-500">Cliente</p>
                    <div class="col-sm-12">
                         <div class="input-group fg-float m-b-30">
                            <span class="input-group-addon"><i class="zmdi zmdi-account"></i></span>
                            <div class="fg-line">
                                <input type="text" name="name" class="form-control input-lg" placeholder="" value="{{cliente.name}}">
                                <label class="fg-label">Nombre del Cliente</label>
                            </div>
                        </div>
                    </div>   

                    <div class="col-sm-6">
                        <div class="input-group fg-float m-b-30">
                            <span class="input-group-addon"><i class="zmdi zmdi-phone"></i></span>
                            <div class="fg-line">
                               <input type="text" name="telephone" class="form-control input-lg" value="{{cliente.telephone}}">
                                <label class="fg-label">Telefono</label>
                            </div>
                        </div>
                    </div> 

                    <div class="col-sm-6">
                        <div class="input-group fg-float m-b-30">
                            <span class="input-group-addon"><i class="zmdi zmdi-email"></i></span>
                            <div class="fg-line">
                               <input type="email" name="email" class="form-control input-lg" value="{{cliente.email}}">
                                <label class="fg-label">Correo Electronico</label>
                            </div>
                        </div>
                    </div>   

                     <p class="c-black f-500">Cita / Tatuaje</p>
                    
                    <div class="col-sm-12">
                        <div class="input-group fg-float m-b-30">
                            <span class="input-group-addon"><i class="zmdi zmdi-label"></i></span>
                            <div class="fg-line">
                                <input type="text" name="title" class="form-control input-lg" value="{{cita.title}}">
                                <label class="fg-label">Título</label>
                            </div>
                        </div>
                    </div>   
                 
                    <div class="col-sm-12">
                        <div class="input-group fg-float m-b-30">
                            <span class="input-group-addon"><i class="zmdi zmdi-comment"></i></span>
                            <div class="fg-line">
                                 <textarea class="form-control auto-size input-sm" name="description">{{cita.description}}</textarea>
                                <label class="fg-label">Descripción</label>
                            </div>
                        </div>
                    </div> 

                    <div class="col-sm-12">
                        <div class="input-group fg-float m-b-30">
                            <span class="input-group-addon"><i class="zmdi zmdi-calendar"></i></span>
                            <div class="fg-line">
                               <input type="text" name="date" class="form-control" id="txtfecha">
                                <label class="fg-label">Fecha y hora</label>
                            </div>
                        </div>
                    </div>

                   <!--  <div class="col-sm-6">
                        <div class="input-group fg-float m-b-30">
                            <span class="input-group-addon"><i class="zmdi zmdi-watch"></i></span>
                            <div class="fg-line">
                               <input type="text" name="time" class="form-control" id="txthora">
                                <label class="fg-label">Hora Final</label>
                            </div>
                        </div>
                    </div> -->

                    <div class="col-sm-12 m-b-25">
                      <!--   <p class="f-500 m-b-15 c-black">Tiempo de la Sesión</p> -->
                           
                       <select class="selectpicker" name="sessionTime" id="ddltime">
                            <option value="-1" selected="selected">Tiempo de la Sesión</option>
                            <option value=".5">Media Hora</option>
                            <option value="1">1 Hora</option>
                            <option value="2">2 Horas</option>
                            <option value="3">3 Horas</option>
                            <option value="4">4 Horas</option>
                            
                        </select>
                    
                    </div>
                    
                    <!-- <p class="c-black f-500">Tattoo</p> -->

                    <div class="col-sm-4">
                        <div class="input-group fg-float m-b-30">
                            <span class="input-group-addon"><i class="zmdi zmdi-money"></i></span>
                            <div class="fg-line">
                                 <input type="text" name="price" class="form-control input-lg" value="{{cita.price}}" id="txtprice">
                                <label class="fg-label">Precio</label>
                            </div>
                        </div>
                    </div>   
                     {% if user.profile.profilecode === 1 %}

                    <div class="col-sm-4">
                        <div class="input-group fg-float m-b-30">
                            <span class="input-group-addon"><i class="zmdi zmdi-money-box"></i></span>
                            <div class="fg-line">
                                 <input type="text" name="advancePay" class="form-control input-lg" value="{{cita.advancepay}}">
                                <label class="fg-label">Anticipo</label>
                            </div>
                        </div>
                    </div> 

                    <div class="col-sm-4">
                        <div class="input-group fg-float m-b-30">
                            <span class="input-group-addon"><i class="zmdi zmdi-money-box"></i></span>
                            <div class="fg-line">
                                 <input type="text" name="comi" class="form-control input-lg" value="{{cita.comi }}">
                                <label class="fg-label">Comisión</label>
                            </div>
                        </div>
                    </div> 

                    {% endif %}
                    
                    <div class="col-sm-6 m-b-25">

                        <p class="f-500 m-b-15 c-black">Tipo de Pago</p>
                           
                        <select class="selectpicker" name="typePay" ID="ddltypepay">
                            
                            <option value="1">Efectivo</option>
                            <option value="2">Tarjeta</option>
                            
                        </select>
                    
                    </div>
                        
                   

                    {% if user.profile.profilecode === 1 %}

                        
                        <div class="col-sm-6 m-b-25">
                        <p class="f-500 m-b-15 c-black">Selecciona Artista</p>
                           
                           <select class="selectpicker" data-live-search="true" name="tattooer" id="tattooer">
                                
                                {% for d in users %}
                                        <option value="{{ d.uuid }}">{{ d.displayName }}</option>
                                {% endfor %}
                            </select>
                        </div>
                   
                    {% endif %}
                    

                   

                     <div class="col-sm-6 m-b-25" id="tipocobro" style="display:none;">
                        <p class="f-500 m-b-15 c-black">Tipo de Cobro</p>
                           
                       <select class="selectpicker" name="meses" id='ddltypecharge'>
                            
                            <option value="-1" selected="selected">Seleccionar</option>
                            <option value="0">Contado</option>
                            <option value="3">3 Meses</option>
                            <option value="6">6 Meses</option>
                            <option value="9">9 Meses</option>
                            <option value="12">12 Meses</option>
                            
                        </select>
                    
                    </div>

                     <div class="col-sm-6 m-b-25" id="tblcomisiones" style="display:none;"">
                                
                         <div class="card-body table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Condicion de Pago</th>
                                        <th>%</th>
                                        <th>Monto a cobrar</th> 
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Contado</td>
                                        <td>4.18</td>
                                        <td><label id="lblcontado"></label></td>

                                    </tr>
                                    <tr>
                                        <td>3 Meses</td>
                                        <td>9.40</td>
                                        <td><label id="lbl3meses"></label></td>

                                    </tr>  
                                    <tr>
                                        <td>6 Meses</td>
                                        <td>12.88</td>
                                        <td><label id="lbl6meses"></label></td>

                                    </tr>  
                                    <tr>
                                        <td>9 Meses</td>
                                        <td>15.66</td>
                                        <td><label id="lbl9meses"></label></td>

                                    </tr> 
                                    <tr>
                                        <td>12 Meses</td>
                                        <td>18.04</td>
                                        <td><label id="lbl12meses"></label></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>

                    


                    <div class="col-sm-12">
                        <div class="fileinput fileinput-new" data-provides="fileinput">
                            <div class="fileinput-preview thumbnail" data-trigger="fileinput"></div>
                            <div>
                                <span class="btn btn-info btn-file">
                                    <span class="fileinput-new">Seleccionar</span>
                                    <span class="fileinput-exists">Cambiar</span>
                                    <input type="file" name="fileinput">
                                </span>
                                <a href="#" class="btn btn-danger fileinput-exists" data-dismiss="fileinput">Eliminar</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-sm-12">
                        <div class="input-group fg-float m-b-30">
                            <div class="fg-line">
                                <button class="btn bgm-deeporange waves-effect" type="submit">Guardar</button>
                                <button class="btn btn-default waves-effect" id="btn-cancel">Cancelar</button>
                                <button class="btn bgm-green waves-effect" id="btn-cobrar">Cobrar</button>
                            </div>
                        </div>
                    </div>    
                </form>
            </div>
        </div>
    </div>
</div>

   <!--  
    
    

    
    
    <script src="/vendors/bower_components/Waves/dist/waves.min.js"></script>
    <script src="/vendors/bootstrap-growl/bootstrap-growl.min.js"></script>
    <script src="/vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.min.js"></script>

   
  
    
    
    <script src="/vendors/bower_components/typeahead.js/dist/typeahead.bundle.min.js"></script>
    <script src="/vendors/summernote/dist/summernote-updated.min.js"></script>

    
    <script src="/vendors/fileinput/fileinput.min.js"></script>
    <script src="/vendors/input-mask/input-mask.min.js"></script>
    <script src="/vendors/farbtastic/farbtastic.min.js"></script>
 -->
    <script src="/vendors/bower_components/jquery/dist/jquery.min.js"></script>
    

   <!--  <script src="/vendors/bower_components/chosen/chosen.jquery.min.js"></script>
    <script src="/vendors/bower_components/bootstrap-select/dist/js/bootstrap-select.js"></script>
    <script src="/vendors/bower_components/autosize/dist/autosize.min.js"></script>
    
    
    <script src="/vendors/summernote/dist/summernote-updated.min.js"></script>
 -->
    <script src="/vendors/bower_components/nouislider/distribute/jquery.nouislider.all.min.js"></script>
    <script src="/vendors/bower_components/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="/vendors/bower_components/bootstrap-select/dist/js/bootstrap-select.js"></script>
    <script src="/vendors/bower_components/moment/min/moment.min.js"></script>
    <script src="/vendors/bower_components/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <script src="vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.min.js"></script>
    
    <!-- <script src="/js/functions.js"></script> -->




<script type="text/javascript">
    
    $('#btn-cancel').click(function(event){
        event.preventDefault();
        window.location.href = '/'; 
    })

    var dateStart = new Date('{{cita.dateStart.toISOString()}}')
    var dateEnd = new Date('{{cita.dateEnd.toISOString()}}')

    
    var hs = dateStart.getHours()
    var he = dateEnd.getHours()

    var h = he - hs;

    $('#ddltime').val(h)

    $('#ddltypepay').val({{cita.typePay}})

    $('#txtfecha').datetimepicker({
        
        defaultDate: new Date('{{cita.dateStart.toISOString()}}')
        // defaultDate: moment(dateStart).format('DD/MM/YYYY hh:mm A')
    });

    $('#btn-cobrar').click(function(event){
    event.preventDefault();
       $.ajax({
            url: "http://localhost:3000/chargepayment/{{cita.uuid}}",
            context: document.body
        }).done(function(err,res) {
                //Success Message

                if(err)
                {
                    swal('Pago <b>NO</b> Registrado!', res, 'Pagos')
                }
           
                swal('Pago Registrado!', res, 'Pagos')
            
            });
    })


    $('#ddltypepay').change(function(){

        if($(this).val() === '2')
        {
            $('#ddltypecharge').val('-1')
            $('#tipocobro').show('slow')
            $('#tblcomisiones').show('slow')

            calcularclip()
        }
        else
        {
            $('#ddltypecharge').val('-1')
            $('#tipocobro').hide('slow')
            $('#tblcomisiones').hide('slow')
        }

    })

    $('#tattooer').val('{{cita.createdBy.uuid}}')

    $('#txtprice').blur(function(){


        calcularclip()
    })
    

    if({{cita.typePay}} === 2){

        $('#tipocobro').show()

    }
    else
    {

        $('#tipocobro').hide()

    }

    function calcularclip(){

        valTotal = parseInt($('#txtprice').val())
            

            if(!isNaN(valTotal)){

                var cont = (valTotal + ((valTotal * 4.18).toFixed(2) / 100)).toFixed(2)
                var tresmes = (valTotal + ((valTotal *  9.40).toFixed(2) / 100)).toFixed(2)
                var sesimes = (valTotal + ((valTotal * 12.88).toFixed(2) / 100)).toFixed(2)
                var nuevemes = (valTotal + ((valTotal * 15.66).toFixed(2) / 100)).toFixed(2)
                var docemes = (valTotal + ((valTotal * 18.04).toFixed(2) / 100)).toFixed(2)


                $('#lblcontado').text('$ ' + cont)
                $('#lbl3meses').text('$ ' + tresmes)
                $('#lbl6meses').text('$ ' + sesimes)
                $('#lbl9meses').text('$ ' + nuevemes)
                $('#lbl12meses').text('$ ' + docemes)


              

            }
            else
            {

                $('#ddltypecharge').val('-1')
                swal('Precio','Debes ingresar un precio total del tatuaje','warning')

            }
    }

    // $('#txthora').datetimepicker({
    //     format: 'HH:mm',
    //     minDate: new Date()
    // });


    


</script>


	


	
		
